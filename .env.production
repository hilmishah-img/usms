# USMS API - Production Environment Configuration
# ================================================
# This file contains all environment variables needed for production deployment.
# Copy this file to .env and update with your actual values.
#
# IMPORTANT: Never commit .env files with real credentials to git!

# =============================================================================
# CRITICAL SECURITY SETTINGS
# =============================================================================

# JWT Secret Key - REQUIRED in production
# Generate using: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
# This secret is used to sign and verify JWT tokens
USMS_JWT_SECRET=CHANGE_ME_IN_PRODUCTION

# JWT Token Expiration (seconds)
# Default: 86400 (24 hours)
# Recommendation: 3600-86400 depending on security requirements
USMS_JWT_EXPIRATION=86400

# =============================================================================
# API SERVER SETTINGS
# =============================================================================

# Server bind address
# Use 0.0.0.0 for Docker (allows external access)
# Use 127.0.0.1 for localhost-only access
USMS_API_HOST=0.0.0.0

# Server port
# Default: 8000
# Change if port 8000 is already in use
USMS_API_PORT=8000

# Number of worker processes (production only)
# Formula: (2 × CPU cores) + 1
# Ignored when using --reload flag
# Recommendation: Start with 4, monitor and adjust based on load
USMS_API_WORKERS=4

# Auto-reload on code changes (development only)
# NEVER set to true in production
USMS_API_RELOAD=false

# =============================================================================
# RATE LIMITING
# =============================================================================

# Maximum requests per user per time window
# Default: 100
# Adjust based on expected usage patterns
USMS_API_RATE_LIMIT=100

# Rate limit time window (seconds)
# Default: 3600 (1 hour)
USMS_API_RATE_WINDOW=3600

# =============================================================================
# CACHING CONFIGURATION
# =============================================================================

# L1 (In-Memory) Cache Settings
# Maximum number of items in memory cache
# Default: 1000
# Higher values use more memory but reduce disk access
USMS_CACHE_MEMORY_SIZE=1000

# L2 (Disk) Cache Settings
# Cache is stored in /data/cache/ directory
# No size limit - disk cache uses SQLite with automatic eviction

# Cache TTL for account data (seconds)
# Default: 900 (15 minutes)
# Account data changes infrequently
USMS_CACHE_TTL_ACCOUNT=900

# Cache TTL for current meter data (seconds)
# Default: 300 (5 minutes)
# Meter unit/credit data updates more frequently
USMS_CACHE_TTL_METER_CURRENT=300

# Cache TTL for consumption history (seconds)
# Default: 3600 (1 hour)
# Historical data doesn't change
USMS_CACHE_TTL_CONSUMPTION=3600

# =============================================================================
# BACKGROUND JOBS
# =============================================================================

# Enable background scheduler
# Runs cache cleanup and maintenance tasks
# Default: true
# Only disable for debugging
USMS_ENABLE_SCHEDULER=true

# =============================================================================
# WEBHOOK CONFIGURATION (Future Feature)
# =============================================================================

# Webhook request timeout (seconds)
# Default: 10
USMS_WEBHOOK_TIMEOUT=10

# Maximum webhook failures before disabling
# Default: 3
USMS_WEBHOOK_MAX_FAILURES=3

# =============================================================================
# DOCKER-SPECIFIC SETTINGS
# =============================================================================

# Port mapping for docker-compose
# External port that will be exposed on host
API_PORT=8000

# =============================================================================
# LOGGING (Optional)
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO
# Use DEBUG only for troubleshooting
# LOG_LEVEL=INFO

# =============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# =============================================================================
#
# Before deploying to production, ensure:
#
# ✓ Generate strong JWT_SECRET (use command above)
# ✓ Set appropriate JWT_EXPIRATION for your security requirements
# ✓ Configure worker count based on server CPU cores
# ✓ Ensure USMS_API_RELOAD=false
# ✓ Set up reverse proxy (nginx/Traefik) with HTTPS/TLS
# ✓ Configure CORS allowed origins in api/main.py
# ✓ Set up log aggregation (ELK, Grafana Loki)
# ✓ Configure persistent volume backups for /data
# ✓ Set up health check monitoring
# ✓ Configure firewall rules (only expose necessary ports)
# ✓ Review and adjust rate limits based on expected load
# ✓ Test cache performance and adjust TTLs if needed
# ✓ Document all environment variables in your deployment docs
#
# =============================================================================
